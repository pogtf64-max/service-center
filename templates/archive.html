{% extends "base.html" %}

{% block title %}Архив{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="bi bi-archive"></i> Архив выданных устройств
        </h1>
        <a href="{{ url_for('dashboard.index') }}" class="btn btn-primary">
            <i class="bi bi-arrow-left"></i> Назад к панели управления
        </a>
    </div>

    <!-- Search and Stats -->
    <div class="row mb-4">
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control" id="searchInput" placeholder="Поиск по бренду, модели, серийному номеру или клиенту...">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary w-100" onclick="searchArchive()">
                                <i class="bi bi-search"></i> Найти
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow">
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-12">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Всего выдано
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalIssued">{{ issued_orders|length }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Archive Orders -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="bi bi-archive"></i> Выданные устройства
            </h6>
        </div>
        <div class="card-body">
            <div class="row" id="archiveList">
                {% for order in issued_orders %}
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
                    <div class="card h-100 shadow-sm border-0 {% if highlight_order_id and order.id == highlight_order_id|int %}border-warning border-3{% endif %}">
                        <div class="card-header bg-success text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-check-circle"></i> Заказ #{{ order.id }}
                                </h6>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-sm btn-outline-light" onclick="viewOrderHistory({{ order.id }})" title="История">
                                        <i class="bi bi-clock-history"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-light" onclick="printCompletedWork({{ order.id }})" title="АВР">
                                        <i class="bi bi-printer"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body py-2">
                            <div class="row mb-2">
                                <div class="col-6">
                                    <strong>Клиент:</strong><br>
                                    <span class="text-primary">{{ order.client.name }}</span>
                                </div>
                                <div class="col-6">
                                    <strong>Устройство:</strong><br>
                                    <span class="text-info">{{ order.device.brand }} {{ order.device.model }}</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">
                                    <strong>Серийный номер:</strong><br>
                                    <span class="text-muted">{{ order.device.serial_number or '—' }}</span>
                                </div>
                                <div class="col-6">
                                    <strong>IMEI:</strong><br>
                                    <span class="text-muted">{{ order.device.imei or '—' }}</span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-6">
                                    <strong>Стоимость:</strong><br>
                                    <span class="text-success">{{ "%.2f"|format(order.final_cost or order.cost_estimate or 0) }} ₽</span>
                                </div>
                                <div class="col-6">
                                    <strong>Гарантия:</strong><br>
                                    <span class="text-muted">{{ order.warranty_months or 0 }} мес.</span>
                                </div>
                            </div>
                            <small class="text-muted">
                                <i class="bi bi-calendar"></i> Выдан: {{ order.updated_at.strftime('%d.%m.%Y %H:%M') if order.updated_at else '—' }}
                            </small>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Order History Modal -->
<div class="modal fade" id="orderHistoryModal" tabindex="-1">
    <div class="modal-dialog modal-xl" style="max-width: 90vw; width: 90vw; max-height: 90vh; height: 90vh;">
        <div class="modal-content" style="height: 100%; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-clock-history"></i> История заказа
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="flex: 1; overflow-y: auto;">
                <div id="orderHistoryContent">
                    <!-- История будет загружена динамически -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>

<script>
// Поиск в архиве
function searchArchive() {
    const query = document.getElementById('searchInput').value;
    
    fetch(`/api/archive?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            renderArchive(data);
        })
        .catch(error => {
            console.error('Ошибка поиска:', error);
        });
}

// Отображение результатов архива
function renderArchive(orders) {
    const container = document.getElementById('archiveList');
    const totalElement = document.getElementById('totalIssued');
    
    totalElement.textContent = orders.length;
    
    if (orders.length === 0) {
        container.innerHTML = `
            <div class="col-12">
                <div class="text-center py-4">
                    <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-2">Заказы не найдены</p>
                </div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = orders.map(order => `
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-header bg-success text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="bi bi-check-circle"></i> Заказ #${order.id}
                        </h6>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-light" onclick="viewOrderHistory(${order.id})" title="История">
                                <i class="bi bi-clock-history"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-light" onclick="printCompletedWork(${order.id})" title="АВР">
                                <i class="bi bi-printer"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body py-2">
                    <div class="row mb-2">
                        <div class="col-6">
                            <strong>Клиент:</strong><br>
                            <span class="text-primary">${order.client.name}</span>
                        </div>
                        <div class="col-6">
                            <strong>Устройство:</strong><br>
                            <span class="text-info">${order.device.brand} ${order.device.model}</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <strong>Серийный номер:</strong><br>
                            <span class="text-muted">${order.device.serial_number || '—'}</span>
                        </div>
                        <div class="col-6">
                            <strong>IMEI:</strong><br>
                            <span class="text-muted">${order.device.imei || '—'}</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <strong>Стоимость:</strong><br>
                            <span class="text-success">${(order.final_cost || order.cost_estimate || 0).toFixed(2)} ₽</span>
                        </div>
                        <div class="col-6">
                            <strong>Гарантия:</strong><br>
                            <span class="text-muted">${order.warranty_months || 0} мес.</span>
                        </div>
                    </div>
                    <small class="text-muted">
                        <i class="bi bi-calendar"></i> Выдан: ${new Date(order.updated_at).toLocaleDateString('ru-RU')} ${new Date(order.updated_at).toLocaleTimeString('ru-RU')}
                    </small>
                </div>
            </div>
        </div>
    `).join('');
}

// Просмотр истории заказа
async function viewOrderHistory(orderId) {
    try {
        // Загружаем историю статусов
        const historyResponse = await fetch(`/api/archive/${orderId}/history`);
        const historyData = await historyResponse.json();
        
        // Получаем данные заказа для получения device_id
        const orderResponse = await fetch(`/api/archive/${orderId}`);
        const orderData = await orderResponse.json();
        
        // Получаем сохраненные АВР из localStorage
        const workReports = JSON.parse(localStorage.getItem('workReports') || '{}');
        const deviceId = orderData.device_id;
        const deviceReports = workReports[deviceId] || [];
        
        // Объединяем историю статусов и АВР
        const allEntries = [];
        
        // Добавляем записи истории статусов
        historyData.forEach(entry => {
            allEntries.push({
                type: 'status',
                data: entry,
                timestamp: new Date(entry.created_at)
            });
        });
        
        // Добавляем АВР
        deviceReports.forEach(report => {
            if (!report.parts) report.parts = [];
            if (!report.services) report.services = [];
            
            allEntries.push({
                type: 'work_report',
                data: report,
                timestamp: new Date(report.created_at)
            });
        });
        
        // Сортируем по времени (новые сверху)
        allEntries.sort((a, b) => b.timestamp - a.timestamp);
        
            const content = document.getElementById('orderHistoryContent');
        
        if (allEntries.length === 0) {
            content.innerHTML = `
                <h6>История изменений статусов для заказа #${orderId}</h6>
                <div class="text-center py-3">
                    <i class="bi bi-info-circle text-muted"></i>
                    <p class="text-muted mt-2">История изменений отсутствует</p>
                </div>
            `;
        } else {
            content.innerHTML = `
                <h6>История изменений статусов для заказа #${orderId}</h6>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Тип</th>
                                <th>Старый статус</th>
                                <th>Новый статус</th>
                                <th>Комментарий</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allEntries.map(entry => {
                                if (entry.type === 'status') {
                                    const statusData = entry.data;
                                    return `
                                        <tr>
                                            <td>${entry.timestamp.toLocaleString('ru-RU')}</td>
                                            <td><span class="badge bg-primary">Статус</span></td>
                                            <td>${statusData.old_status_display || '—'}</td>
                                            <td>${statusData.new_status_display}</td>
                                            <td>${statusData.comment || '—'}</td>
                                            <td>—</td>
                                        </tr>
                                    `;
                                } else if (entry.type === 'work_report') {
                                    const reportData = entry.data;
                                    return `
                                        <tr class="table-success">
                                            <td colspan="6">
                                                <div class="card border-success mb-2">
                                                    <div class="card-header bg-success text-white">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <div>
                                                                <i class="bi bi-file-text"></i> Акт выполненных работ
                                                                <span class="badge bg-light text-dark ms-2">АВР #${reportData.id}</span>
                                                            </div>
                                                            <small>${entry.timestamp.toLocaleString('ru-RU')}</small>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <p class="mb-1"><strong>Стоимость:</strong> ${reportData.total_cost} ₽</p>
                                                                <p class="mb-1"><strong>Описание:</strong> ${reportData.work_description ? reportData.work_description.substring(0, 100) + (reportData.work_description.length > 100 ? '...' : '') : 'Без описания'}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                ${reportData.parts && reportData.parts.length > 0 ? `<p class="mb-1"><strong>Запчасти:</strong> ${reportData.parts.length} шт.</p>` : ''}
                                                                ${reportData.services && reportData.services.length > 0 ? `<p class="mb-1"><strong>Услуги:</strong> ${reportData.services.length} шт.</p>` : ''}
                                                            </div>
                                                        </div>
                                                        <div class="mt-2">
                                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewWorkReportFromArchive('${reportData.id}')" title="Просмотр">
                                                                <i class="bi bi-eye"></i> Просмотр
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-success me-1" onclick="printWorkReportFromArchive('${reportData.id}')" title="Печать">
                                                                <i class="bi bi-printer"></i> Печать
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteWorkReportFromArchive('${reportData.id}', ${deviceId})" title="Удалить">
                                                                <i class="bi bi-trash"></i> Удалить
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                </tr>
                                    `;
                                }
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
            
            new bootstrap.Modal(document.getElementById('orderHistoryModal')).show();
    } catch (error) {
        console.error('Ошибка загрузки истории:', error);
        const content = document.getElementById('orderHistoryContent');
        content.innerHTML = '<p class="text-danger">Ошибка загрузки истории</p>';
    }
}

// Функции для работы с АВР из архива
function viewWorkReportFromArchive(reportId) {
    try {
        const workReports = JSON.parse(localStorage.getItem('workReports') || '{}');
        let foundReport = null;
        let deviceId = null;
        
        // Ищем АВР по ID
        for (const [devId, reports] of Object.entries(workReports)) {
            const report = reports.find(r => r.id == reportId);
            if (report) {
                foundReport = report;
                deviceId = devId;
                break;
            }
        }
        
        if (!foundReport) {
            alert('АВР не найден');
            return;
        }
        
        // Загружаем данные устройства и клиента
        fetch(`/api/devices/${deviceId}`)
            .then(response => response.json())
            .then(deviceData => {
                if (deviceData.error) {
                    alert('Ошибка загрузки данных устройства: ' + deviceData.error);
                    return;
                }
                
                // Загружаем данные сервисного центра
                fetch('/settings/api/service-data')
                    .then(response => response.json())
                    .then(serviceData => {
                        if (serviceData.error) {
                            alert('Ошибка загрузки данных сервисного центра: ' + serviceData.error);
                            return;
                        }
                        
                        // Генерируем HTML для просмотра
                        const printHTML = generateWorkReportPrintHTML(foundReport, deviceData, serviceData);
                        
                        // Показываем в модальном окне
                        document.getElementById('documentPreviewContent').innerHTML = printHTML;
                        document.getElementById('previewDocumentType').textContent = 'Акт выполненных работ';
                        new bootstrap.Modal(document.getElementById('documentPreviewModal')).show();
                    })
                    .catch(error => {
                        console.error('Ошибка загрузки данных сервисного центра:', error);
                        alert('Ошибка загрузки данных сервисного центра');
                    });
            })
            .catch(error => {
                console.error('Ошибка загрузки данных устройства:', error);
                alert('Ошибка загрузки данных устройства');
            });
    } catch (error) {
        console.error('Ошибка при просмотре АВР:', error);
        alert('Ошибка при просмотре АВР');
    }
}

function printWorkReportFromArchive(reportId) {
    try {
        const workReports = JSON.parse(localStorage.getItem('workReports') || '{}');
        let foundReport = null;
        let deviceId = null;
        
        // Ищем АВР по ID
        for (const [devId, reports] of Object.entries(workReports)) {
            const report = reports.find(r => r.id == reportId);
            if (report) {
                foundReport = report;
                deviceId = devId;
                break;
            }
        }
        
        if (!foundReport) {
            alert('АВР не найден');
            return;
        }
        
        // Загружаем данные устройства и клиента
        fetch(`/api/devices/${deviceId}`)
            .then(response => response.json())
            .then(deviceData => {
                if (deviceData.error) {
                    alert('Ошибка загрузки данных устройства: ' + deviceData.error);
                    return;
                }
                
                // Загружаем данные сервисного центра
                fetch('/settings/api/service-data')
                    .then(response => response.json())
                    .then(serviceData => {
                        if (serviceData.error) {
                            alert('Ошибка загрузки данных сервисного центра: ' + serviceData.error);
                            return;
                        }
                        
                        // Генерируем HTML для печати
                        const printHTML = generateWorkReportPrintHTML(foundReport, deviceData, serviceData);
                        
                        // Открываем окно печати
                        const printWindow = window.open('', '_blank');
                        if (printWindow) {
                            printWindow.document.write(printHTML);
                            printWindow.document.close();
                            printWindow.focus();
                            printWindow.print();
                        } else {
                            alert('Не удалось открыть окно печати. Возможно, блокировщик всплывающих окон заблокировал окно.');
                        }
                    })
                    .catch(error => {
                        console.error('Ошибка загрузки данных сервисного центра:', error);
                        alert('Ошибка загрузки данных сервисного центра');
                    });
            })
            .catch(error => {
                console.error('Ошибка загрузки данных устройства:', error);
                alert('Ошибка загрузки данных устройства');
            });
    } catch (error) {
        console.error('Ошибка при печати АВР:', error);
        alert('Ошибка при печати АВР');
    }
}

function deleteWorkReportFromArchive(reportId, deviceId) {
    if (!confirm('Вы уверены, что хотите удалить этот АВР?')) {
        return;
    }
    
    try {
        const workReports = JSON.parse(localStorage.getItem('workReports') || '{}');
        const deviceReports = workReports[deviceId] || [];
        
        const reportIndex = deviceReports.findIndex(report => report.id == reportId);
        if (reportIndex !== -1) {
            deviceReports.splice(reportIndex, 1);
            workReports[deviceId] = deviceReports;
            localStorage.setItem('workReports', JSON.stringify(workReports));
            
            // Обновляем отображение истории
            const currentOrderId = new URLSearchParams(window.location.search).get('order_id');
            if (currentOrderId) {
                viewOrderHistory(currentOrderId);
            }
            
            alert('АВР успешно удален');
        } else {
            alert('АВР не найден');
        }
    } catch (error) {
        console.error('Ошибка при удалении АВР:', error);
        alert('Ошибка при удалении АВР');
    }
}

// Функция генерации HTML для печати АВР (копируем из orders.html)
function generateWorkReportPrintHTML(reportData, deviceData, serviceData) {
    return `
        <!DOCTYPE html>
        <html lang="ru">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Акт выполненных работ</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
                .header { text-align: center; margin-bottom: 30px; }
                .title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
                .date { font-size: 14px; }
                .section { margin-bottom: 20px; }
                .section h4 { font-size: 14px; margin-bottom: 10px; border-bottom: 1px solid #000; }
                .info-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
                .info-table td { padding: 5px; border: 1px solid #000; }
                .info-table .label { font-weight: bold; background-color: #f5f5f5; width: 30%; }
                .parts-table, .services-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
                .parts-table th, .parts-table td, .services-table th, .services-table td { 
                    padding: 8px; border: 1px solid #000; text-align: center; 
                }
                .parts-table th, .services-table th { background-color: #f5f5f5; font-weight: bold; }
                .total { font-weight: bold; font-size: 16px; text-align: right; margin-top: 20px; }
                .signatures { display: flex; justify-content: space-between; margin-top: 40px; }
                .signature-block { width: 45%; text-align: center; }
                .signature-line { border-bottom: 1px solid #000; height: 40px; margin-bottom: 5px; }
            </style>
        </head>
        <body>
            <div class="header">
                <div class="title">АКТ ВЫПОЛНЕННЫХ РАБОТ №${reportData.id} от ${new Date(reportData.created_at).toLocaleDateString('ru-RU')}</div>
                <div class="date">${new Date(reportData.created_at).toLocaleString('ru-RU')}</div>
            </div>
            
            <div class="section">
                <h4>1. Исполнитель:</h4>
                <table class="info-table">
                    <tr><td class="label">Организация:</td><td>${serviceData ? serviceData.name : 'Не указано'}</td></tr>
                    <tr><td class="label">Юридический адрес:</td><td>${serviceData ? serviceData.legal_address : 'Не указано'}</td></tr>
                    <tr><td class="label">Фактический адрес:</td><td>${serviceData ? serviceData.address : 'Не указано'}</td></tr>
                    <tr><td class="label">Телефон:</td><td>${serviceData ? serviceData.phone : 'Не указано'}</td></tr>
                    <tr><td class="label">Email:</td><td>${serviceData ? serviceData.email : 'Не указано'}</td></tr>
                    <tr><td class="label">ИНН:</td><td>${serviceData ? serviceData.inn : 'Не указано'}</td></tr>
                    <tr><td class="label">ОГРН:</td><td>${serviceData ? serviceData.ogrn : 'Не указано'}</td></tr>
                </table>
            </div>
            
            <div class="section">
                <h4>2. Заказчик:</h4>
                <table class="info-table">
                    <tr><td class="label">ФИО:</td><td>${deviceData.client ? deviceData.client.name : 'Не указано'}</td></tr>
                    <tr><td class="label">Телефон:</td><td>${deviceData.client ? deviceData.client.phone : 'Не указано'}</td></tr>
                    <tr><td class="label">Адрес:</td><td>${deviceData.client ? deviceData.client.address : 'Не указано'}</td></tr>
                    <tr><td class="label">Email:</td><td>${deviceData.client ? deviceData.client.email : 'Не указано'}</td></tr>
                </table>
            </div>
            
            <div class="section">
                <h4>3. Информация об устройстве:</h4>
                <table class="info-table">
                    <tr><td class="label">Устройство:</td><td>${deviceData.brand} ${deviceData.model}</td></tr>
                    <tr><td class="label">Серийный номер:</td><td>${deviceData.serial_number || 'Не указан'}</td></tr>
                </table>
            </div>
            
            <div class="section">
                <h4>4. Выполненные работы:</h4>
                <p><strong>Примечание:</strong> ${reportData.work_description || 'Не указано'}</p>
            </div>
            
            ${reportData.parts && reportData.parts.length > 0 ? `
            <div class="section">
                <h4>5. Использованные запчасти:</h4>
                <table class="parts-table">
                    <thead>
                        <tr>
                            <th>Наименование</th>
                            <th>Количество</th>
                            <th>Цена за ед.</th>
                            <th>Сумма</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${reportData.parts.map(part => `
                            <tr>
                                <td>${part.name}</td>
                                <td>${part.quantity}</td>
                                <td>${part.price} ₽</td>
                                <td>${part.total} ₽</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            ` : ''}
            
            ${reportData.services && reportData.services.length > 0 ? `
            <div class="section">
                <h4>6. Выполненные услуги:</h4>
                <table class="services-table">
                    <thead>
                        <tr>
                            <th>Наименование услуги</th>
                            <th>Стоимость</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${reportData.services.map(service => `
                            <tr>
                                <td>${service.name}</td>
                                <td>${service.price} ₽</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            ` : ''}
            
            <div class="total">
                <strong>Итоговая стоимость работ: ${reportData.total_cost} ₽</strong>
            </div>
            
            <div class="section">
                <h4>7. Гарантийный срок:</h4>
                <p>30 дней</p>
            </div>
            
            <div class="signatures">
                <div class="signature-block">
                    <p><strong>От Заказчика:</strong></p>
                    <div class="signature-line"></div>
                    <p>(подпись) / (ФИО)</p>
                </div>
                <div class="signature-block">
                    <p><strong>От Исполнителя:</strong></p>
                    <div class="signature-line"></div>
                    <p>(подпись) / (ФИО)</p>
                </div>
            </div>
        </body>
        </html>
    `;
}

// Печать АВР
function printCompletedWork(orderId) {
    // Здесь можно добавить логику для печати АВР
    alert('Функция печати АВР будет реализована');
}

// Поиск при нажатии Enter
document.getElementById('searchInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        searchArchive();
    }
});
</script>

<!-- Document Preview Modal -->
<div class="modal fade" id="documentPreviewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewDocumentType">Предварительный просмотр</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                <div id="documentPreviewContent">
                    <!-- Содержимое документа будет загружено здесь -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}
